---
format: 
  html:
    embed-resources: true
editor:
    render-on-save: false
execute: 
  echo: false
  warning: false
  fig-width: 10
  fig-height: 5
---


```{r}
library(tidyverse)
library(glue)
library(ggthemes)
library(scales)
```


# Test

```{r}
num <- 125000
num_years <- 25
set.seed(44)

data <- read_csv("data/simulations.csv")

data |>
    group_by(name) |>
    summarise(mean = mean(growth), sd = sd(growth))

final_capital <- data |>
    group_by(name, simulation) |>
    summarise(total_growth = prod(growth)) |>
    ungroup()
```

```{r}

final_capital |>
    ggplot(aes(total_growth, fill = name)) +
    geom_histogram(bins = 100) +
    geom_vline(xintercept = 1, linetype = "dotted") +
    scale_x_continuous(trans = "log10", labels = percent) +
    scale_y_continuous(trans = "log10") +
    scale_fill_tableau() +
    facet_wrap(~name) +
    theme_minimal() +
    labs(title = "Alice vs Bob", subtitle = "Wealth Distribution", x = "Total Growth after {num_years} years" |> glue(), y = "Number")

final_capital |>
    mutate(ruined = ifelse(total_growth < 1, T, F)) |>
    group_by(name, ruined) |>
    summarise(n = n()) |>
    mutate(ratio = n / sum(n))

```